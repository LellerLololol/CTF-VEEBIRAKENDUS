{"ast":null,"code":"import'../App.css';import Offer from'../components/offer';import{useEffect,useState}from'react';import Header from'../components/header';import Showcase from'../components/showcase';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Marketplace(){const[offers,setOffers]=useState([]);const[showcase,setShowcase]=useState(null);const[finance,setFinance]=useState(0);const[loading,setLoading]=useState(0);useEffect(()=>{async function fetchOffers(){const response=await fetch('/api/getAllOffers',{method:'GET'});const data=await response.json();console.log(offers);if(!offer.image){const offersWithImages=await Promise.all(data.map(async offer=>{const imageResponse=await fetch(\"/api/get_image.php?file_id=\".concat(offer.id));if(imageResponse.ok){// Convert the image to a blob and create an object URL\nconst{image,error}=await imageResponse.json();if(image){offer.image=\"data:image/jpeg;base64,\".concat(image);}else{offer.image='';}}else{offer.image='';}return offer;}));setOffers(offersWithImages);}else{setOffers(data);}console.log(offers);setLoading(1);}async function fetchUserData(){//const response = await fetch(`/api/Profile?user_id=${userId}`, {\nconst response=await fetch('/api/Profile',{headers:{'Content-Type':'application/json'}});if(response.ok){const data=await response.json();setFinance(data.money);}}const myFunction=\"\\n      async function buyOffer(id, balance, price) {\\n        if(price > balance){\\n\\t\\t\\talert('Hello from the custom function!');\\n\\t\\t\\treturn\\n\\t\\t}\\n\\t\\tconst response = await fetch('/api/buy', {\\n            method: 'POST',\\n            headers: {\\n                'Content-Type': 'application/json'\\n            },\\n            body: JSON.stringify({'id': id})\\n        });\\n\\n        if(response.ok){\\n            console.log('Bought: ', id)\\n        }\\n        else{\\n            console.log('Something went wrong: ', id)\\n        }\\n      }\";const script=document.createElement('script');script.innerHTML=myFunction;document.head.appendChild(script);fetchOffers();fetchUserData();},[]);function closeShowcase(){setShowcase(null);}function showcaseOffer(offer){setShowcase(offer);}return/*#__PURE__*/_jsxs(\"div\",{className:\"Marketplace\",children:[/*#__PURE__*/_jsx(Header,{cash:finance}),/*#__PURE__*/_jsxs(\"div\",{className:\"scrollable\",children:[/*#__PURE__*/_jsx(Showcase,{offer:showcase,close:closeShowcase,balance:finance}),/*#__PURE__*/_jsx(\"div\",{className:\"offerList\",style:{opacity:loading,transition:'opacity 300ms ease-in'},children:offers.map(offer=>/*#__PURE__*/_jsx(\"span\",{children:/*#__PURE__*/_jsx(Offer,{offer:offer,func:showcaseOffer})},offer.id))})]})]});}export default Marketplace;","map":{"version":3,"names":["Offer","useEffect","useState","Header","Showcase","jsx","_jsx","jsxs","_jsxs","Marketplace","offers","setOffers","showcase","setShowcase","finance","setFinance","loading","setLoading","fetchOffers","response","fetch","method","data","json","console","log","offer","image","offersWithImages","Promise","all","map","imageResponse","concat","id","ok","error","fetchUserData","headers","money","myFunction","script","document","createElement","innerHTML","head","appendChild","closeShowcase","showcaseOffer","className","children","cash","close","balance","style","opacity","transition","func"],"sources":["C:/Users/Mike/Code/CTF-VEEBIRAKENDUS/client/src/pages/Marketplace.js"],"sourcesContent":["import '../App.css';\r\nimport Offer from '../components/offer';\r\nimport { useEffect, useState } from 'react'\r\nimport Header from '../components/header';\r\nimport Showcase from '../components/showcase';\r\n\r\nfunction Marketplace() {\r\n\r\n\tconst [offers, setOffers] = useState([])\r\n\tconst [showcase, setShowcase] = useState(null)\r\n\tconst [finance, setFinance] = useState(0)\r\n\tconst [loading, setLoading] = useState(0);\r\n\r\n\tuseEffect(() => {\r\n\t\tasync function fetchOffers() {\r\n\t\t\tconst response = await fetch('/api/getAllOffers', {\r\n\t\t\t\tmethod: 'GET'\r\n\t\t\t})\r\n\t\t\tconst data = await response.json()\r\n\t\t\tconsole.log(offers)\r\n\r\n\t\t\tif(!offer.image) {\r\n\r\n\t\t\t\tconst offersWithImages = await Promise.all(data.map(async (offer) => {\r\n\t\t\t\t\tconst imageResponse = await fetch(`/api/get_image.php?file_id=${offer.id}`);\r\n\t\t\t\t\tif (imageResponse.ok) {\r\n\t\t\t\t\t\t// Convert the image to a blob and create an object URL\r\n\t\t\t\t\t\tconst { image, error } = await imageResponse.json();\r\n\t\t\t\t\t\tif (image) {\r\n\t\t\t\t\t\t\t\toffer.image = `data:image/jpeg;base64,${image}`;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\toffer.image = ''; \r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\toffer.image = '';\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn offer;\r\n\t\t\t\t}));\r\n\t\t\t\tsetOffers(offersWithImages)\r\n\t\t\t} else {\r\n\t\t\t\tsetOffers(data)\r\n\t\t\t}\r\n\r\n\t\t\t\r\n\t\t\tconsole.log(offers)\r\n\t\t\tsetLoading(1);\r\n\t\t}\r\n\r\n\t\tasync function fetchUserData() {\r\n\t\t\t//const response = await fetch(`/api/Profile?user_id=${userId}`, {\r\n\t\t\tconst response = await fetch('/api/Profile', {\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t\tif (response.ok) {\r\n\t\t\t\tconst data = await response.json();\r\n\t\t\t\tsetFinance(data.money);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst myFunction = `\r\n      async function buyOffer(id, balance, price) {\r\n        if(price > balance){\r\n\t\t\talert('Hello from the custom function!');\r\n\t\t\treturn\r\n\t\t}\r\n\t\tconst response = await fetch('/api/buy', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            },\r\n            body: JSON.stringify({'id': id})\r\n        });\r\n\r\n        if(response.ok){\r\n            console.log('Bought: ', id)\r\n        }\r\n        else{\r\n            console.log('Something went wrong: ', id)\r\n        }\r\n      }`\r\n\r\n\r\n\t\tconst script = document.createElement('script')\r\n\t\tscript.innerHTML = myFunction;\r\n\t\tdocument.head.appendChild(script);\r\n\r\n\t\tfetchOffers()\r\n\t\tfetchUserData()\r\n\t}, [])\r\n\r\n\tfunction closeShowcase() {\r\n\t\tsetShowcase(null)\r\n\t}\r\n\r\n\tfunction showcaseOffer(offer) {\r\n\t\tsetShowcase(offer)\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"Marketplace\">\r\n\t\t\t<Header cash={finance} />\r\n\t\t\t<div className='scrollable'>\r\n\t\t\t\t<Showcase offer={showcase} close={closeShowcase} balance={finance} />\r\n\t\t\t\t<div className='offerList' style={{ opacity: loading, transition: 'opacity 300ms ease-in' }}>\r\n\t\t\t\t\t{offers.map((offer) =>\r\n\t\t\t\t\t\t<span key={offer.id}>\r\n\t\t\t\t\t\t\t<Offer offer={offer} func={showcaseOffer} /> \r\n\t\t\t\t\t\t\t{/* <Offer offer={{ ...offer, image: `/uploads/${offer.image}` }} func={showcaseOffer} /> */}\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default Marketplace;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}